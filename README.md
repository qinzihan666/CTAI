# ğŸ¥ CTAI
## **åŸºäºæ·±åº¦å­¦ä¹ çš„è‚¿ç˜¤è¾…åŠ©è¯Šæ–­ç³»ç»Ÿ**

ç³»ç»Ÿä»¥å›¾åƒåˆ†å‰²ä¸ºæ ¸å¿ƒï¼Œåˆ©ç”¨äººå·¥æ™ºèƒ½å®Œæˆè‚¿ç˜¤åŒºåŸŸçš„è¯†åˆ«å‹¾ç”»å¹¶æä¾›è‚¿ç˜¤åŒºåŸŸçš„ç‰¹å¾æ¥è¾…åŠ©åŒ»ç”Ÿè¿›è¡Œè¯Šæ–­ã€‚æœ‰å®Œæ•´çš„**æ¨¡å‹æ„å»ºã€åç«¯æ¶è®¾å’Œå‰ç«¯è®¿é—®**åŠŸèƒ½ã€‚  
åŒ»ç”Ÿåªéœ€é€šè¿‡webä¸Šä¼ ctå›¾åƒæ–‡ä»¶ï¼Œåå°å°±ä¼šä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œè‚¿ç˜¤åŒºåŸŸçš„åˆ†å‰²ï¼Œç„¶åå°†å‹¾ç”»å¥½è‚¿ç˜¤åŒºåŸŸçš„å›¾åƒè¿”å›ï¼Œè¿˜æœ‰è‚¿ç˜¤åŒºåŸŸçš„ä¸€äº›ç‰¹å¾ï¼ˆå¦‚é¢ç§¯ã€å‘¨é•¿ã€å¼ºåº¦ç­‰ï¼‰ï¼Œå¹¶ä¸”æä¾›å‰å‡ æ¬¡è¯Šæ–­çš„ç‰¹å¾æ•°æ®å¹¶ç»˜åˆ¶æˆå›¾è¡¨è¿›è¡Œå¯¹æ¯”æ¥è¾…åŠ©åŒ»ç”Ÿè¯Šæ–­ã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

- **AIè‚¿ç˜¤åˆ†å‰²**ï¼šä½¿ç”¨Unetæ·±åº¦å­¦ä¹ æ¨¡å‹è‡ªåŠ¨è¯†åˆ«å¹¶å‹¾ç”»è‚¿ç˜¤åŒºåŸŸ
- **å¤šæŒ‡æ ‡åˆ†æ**ï¼šæä¾›é¢ç§¯ã€å‘¨é•¿ç­‰å¤šç§è‚¿ç˜¤ç‰¹å¾é‡åŒ–æŒ‡æ ‡
- **è¶‹åŠ¿å¯è§†åŒ–**ï¼šè‡ªåŠ¨ç”Ÿæˆç—…æƒ…å‘å±•è¶‹åŠ¿å›¾è¡¨ï¼Œæ”¯æŒå¤šç»´åº¦æ•°æ®å¯¹æ¯”
- **è¯Šæ–­å†å²è®°å½•**ï¼šè®°å½•å¹¶å±•ç¤ºæ‚£è€…å†æ¬¡è¯Šæ–­ç»“æœï¼Œæ–¹ä¾¿è·Ÿè¸ªç—…æƒ…å˜åŒ–
- **DeepSeek AIåˆ†æ**ï¼šğŸ†• é›†æˆDeepSeekå¤§æ¨¡å‹APIï¼Œè‡ªåŠ¨ç”Ÿæˆä¸“ä¸šçš„åŒ»å­¦åˆ†æå»ºè®®
- **å“åº”å¼è®¾è®¡**ï¼šé€‚é…ä¸åŒå°ºå¯¸çš„å±å¹•ï¼Œæä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒ

## ğŸ“¸ ç³»ç»Ÿæˆªå›¾

![ç³»ç»Ÿç•Œé¢å±•ç¤º](https://github.com/xming521/picture/blob/master/QQæˆªå›¾20200218193846.png)

## ğŸ” é¡¹ç›®ç»“æ„

```plain
CTAI
â”œâ”€â”€ CTAI_flask_torch        # åŸºäºPyTorchçš„åç«¯
â”‚   â”œâ”€â”€ core                # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ data                # æ•°æ®å¤„ç†
â”‚   â””â”€â”€ app.py              # åç«¯ä¸»ç¨‹åº
â”œâ”€â”€ CTAI_model              # æ¨¡å‹è®­ç»ƒä¸æµ‹è¯•
â”‚   â”œâ”€â”€ cv                  # è®¡ç®—æœºè§†è§‰å·¥å…·
â”‚   â”œâ”€â”€ data_set            # æ•°æ®é›†åŠ è½½ä¸å¤„ç†
â”‚   â”œâ”€â”€ net                 # ç¥ç»ç½‘ç»œæ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ utils               # å®ç”¨å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ train.py            # æ¨¡å‹è®­ç»ƒè„šæœ¬
â”‚   â”œâ”€â”€ test.py             # æ¨¡å‹æµ‹è¯•è„šæœ¬
â”‚   â””â”€â”€ best_unet_model.pth # è®­ç»ƒå¥½çš„æ¨¡å‹æƒé‡
â”œâ”€â”€ CTAI_web                # å‰ç«¯Vueé¡¹ç›®
â”‚   â”œâ”€â”€ public              # é™æ€èµ„æº
â”‚   â”œâ”€â”€ src                 # æºä»£ç 
â”‚   â”‚   â”œâ”€â”€ components      # ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ TrendAnalysis.vue # è¶‹åŠ¿åˆ†æç»„ä»¶(æ”¯æŒDeepSeek AI)
â”‚   â”‚   â”œâ”€â”€ App.vue         # ä¸»åº”ç”¨ç»„ä»¶
â”‚   â”‚   â””â”€â”€ main.js         # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ package.json        # ä¾èµ–ç®¡ç†
â”‚   â””â”€â”€ vue.config.js       # Vueé…ç½®
â”œâ”€â”€ tmp                     # ä¸´æ—¶æ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€ ct                  # DICOMæ–‡ä»¶ä¸´æ—¶å­˜å‚¨
â”‚   â”œâ”€â”€ draw                # å¤„ç†ç»“æœå›¾åƒ
â”‚   â”œâ”€â”€ image               # è½¬æ¢åçš„å›¾åƒ
â”‚   â””â”€â”€ mask                # åˆ†å‰²æ©è†œ
â”œâ”€â”€ uploads                 # ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶å¤¹
â”œâ”€â”€ README.md               # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â””â”€â”€ requirements.txt        # Pythonä¾èµ–åˆ—è¡¨
```


## ğŸ› ï¸ å¼€å‘ç¯å¢ƒ
- **Python 3.8**: **PyTorch 1.10.0** , OpenCV 3, Flask
- **Node 16+**: axios, ElementUI, ECharts
- **Vue 2**: Vue-cli
- **æµè§ˆå™¨**: Chromeï¼ˆå†…æ ¸ç‰ˆæœ¬60ä»¥ä¸Šï¼‰


### å®‰è£… PyTorch 1.10.0
- CUDA 11.1
```bash
pip install torch==1.10.0+cu111 torchvision==0.11.0+cu111 torchaudio==0.10.0 -f https://download.pytorch.org/whl/torch_stable.html
```

- CUDA 10.2
```bash
pip install torch==1.10.0+cu102 torchvision==0.11.0+cu102 torchaudio==0.10.0 -f https://download.pytorch.org/whl/torch_stable.html
```
- CPU only
```bash
pip install torch==1.10.0+cpu torchvision==0.11.0+cpu torchaudio==0.10.0 -f https://download.pytorch.org/whl/torch_stable.html
```

### å®‰è£…Pythonä¾èµ–åŒ…
```bash
pip install -r requirements.txt
```

æ³¨æ„ï¼Œåœ¨ requirements.txt ä¸­:
```plain
numpy==1.23.0               # å·®ä¸å¤šç›¸è¿‘çš„ç‰ˆæœ¬å°±è¡Œï¼Œä¸èƒ½å¤ªæ–°
opencv-python==3.4.8.29     # å·®ä¸å¤šç›¸è¿‘çš„ç‰ˆæœ¬å°±è¡Œï¼Œä¸èƒ½ç”¨ 4.x ç‰ˆæœ¬çš„
gevent                      # ç”¨äºç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
requests                    # ç”¨äºAPIè¯·æ±‚
```

### å®‰è£…Nodeç¯å¢ƒ

- Windows:  
 
  [å®˜ç½‘ä¸‹è½½å®‰è£…](https://nodejs.org/)

- Linux: 

  ```bash
  # ä½¿ç”¨nvmç®¡ç†Nodeç‰ˆæœ¬
  curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash
  nvm install 16
  nvm use 16
  ````
  
### å®‰è£…Vueä¾èµ–

```bash
cd CTAI_web
npm install -g @vue/cli
npm install
# æˆ–è€…ä½¿ç”¨yarn
npm install -g yarn
yarn install
```

## ğŸ”„ å¼€å‘ç¯å¢ƒè¿è¡Œ

å¯åŠ¨Vueå‰ç«¯æ¸²æŸ“æœåŠ¡
```bash
cd CTAI_web
npm run serve
```
å¯åŠ¨åç«¯flaskæœåŠ¡
```bash
cd CTAI_flask_torch
python app.py
```

## ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### å‰ç«¯æ„å»º
ç¼–è¯‘Vueå‰ç«¯ä»£ç 
```bash
cd CTAI_web
yarn build
# æˆ–ä½¿ç”¨npm
npm run build
```

### éƒ¨ç½²æ­¥éª¤
1. å°†`CTAI_flask_torch`å’Œ`CTAI_web/dist`ç›®å½•å¤åˆ¶åˆ°æœåŠ¡å™¨
2. å®‰è£…Python 3.8åŠä¾èµ–åŒ…(åŒ…æ‹¬PyTorch)
```bash
pip install -r requirements.txt
pip install torch==1.10.0+cpu torchvision==0.11.0+cpu torchaudio==0.10.0 -f https://download.pytorch.org/whl/torch_stable.html
```
3. é…ç½®DeepSeek API (å¯é€‰)
   - åœ¨`CTAI_flask_torch/app.py`ä¸­è®¾ç½®æ‚¨çš„DeepSeek APIå¯†é’¥
   - å¦‚æœä¸éœ€è¦AIåˆ†æåŠŸèƒ½ï¼Œå¯ä»¥æ³¨é‡Šç›¸å…³ä»£ç 

4. åå°å¯åŠ¨PythonæœåŠ¡
```bash
cd CTAI_flask_torch
nohup python app.py > app.log 2>&1 &
```

5. ä½¿ç”¨Nginxæˆ–å…¶ä»–WebæœåŠ¡å™¨éƒ¨ç½²å‰ç«¯
```bash
# Nginxé…ç½®ç¤ºä¾‹
server {
    listen 80;
    server_name your_domain.com;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /path/to/CTAI_web/dist;
        try_files $uri $uri/ /index.html;
        index index.html;
    }

    # APIä»£ç†
    location /api/ {
        proxy_pass http://localhost:5003;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

6. ä¹Ÿå¯ä½¿ç”¨`PM2`æ¥ç®¡ç†å‰ç«¯æœåŠ¡
```bash
npm install -g serve pm2
cd CTAI_web
pm2 serve ./dist 8080
```

## ğŸ”‘ DeepSeek APIé…ç½®

æœ¬é¡¹ç›®é›†æˆäº†DeepSeekå¤§è¯­è¨€æ¨¡å‹APIç”¨äºç”ŸæˆåŒ»å­¦åˆ†æå»ºè®®ã€‚è¦å¯ç”¨æ­¤åŠŸèƒ½ï¼š

1. æ³¨å†ŒDeepSeekè´¦æˆ·å¹¶è·å–APIå¯†é’¥: https://platform.deepseek.com/
2. åœ¨`CTAI_flask_torch/app.py`ä¸­è®¾ç½®APIå¯†é’¥:
```python
# è®¾ç½®DeepSeek APIå¯†é’¥
api_key = "your_api_key_here"
```

## ğŸ“¦ èµ„æºä¸‹è½½

- [æµ‹è¯•æ•°æ®é›†](https://share.weiyun.com/5eS2jDk)
- [PyTorchæ¨¡å‹ä¸‹è½½](http://47.237.94.141:5244/%E6%95%B0%E6%8D%AE/best_unet_model.pth)

## ğŸ”§ æ¨¡å‹è¯´æ˜
æœ¬é¡¹ç›®ä½¿ç”¨U-Netæ¶æ„è¿›è¡Œè‚¿ç˜¤åˆ†å‰²ã€‚U-Netæ˜¯ä¸€ç§å¹¿æ³›åº”ç”¨äºåŒ»å­¦å›¾åƒåˆ†å‰²çš„å·ç§¯ç¥ç»ç½‘ç»œæ¶æ„ï¼Œå…¶ç‰¹ç‚¹æ˜¯å¯¹ç§°çš„ç¼–ç å™¨-è§£ç å™¨ç»“æ„å’Œè·³è·ƒè¿æ¥ã€‚

<img width="80%" height="80%" src="https://github.com/xming521/picture/blob/master/å›¾ç‰‡3.png"/>

### è®­ç»ƒå‚æ•°
- æŸå¤±å‡½æ•°: äº¤å‰ç†µæŸå¤±
- ä¼˜åŒ–å™¨: Adam
- å­¦ä¹ ç‡: 0.001
- æ‰¹æ¬¡å¤§å°: 2-8 (å–å†³äºGPUå†…å­˜)
- è®­ç»ƒè½®æ¬¡: 20+

## ğŸ§  æ¨¡å‹è®­ç»ƒ

é¡¹ç›®åŒ…å«å®Œæ•´çš„æ¨¡å‹è®­ç»ƒå’Œæµ‹è¯•ä»£ç ï¼Œä½äº`CTAI_model`ç›®å½•ï¼š

### è®­ç»ƒæ–°æ¨¡å‹

1. å‡†å¤‡æ•°æ®é›†ï¼Œå¹¶æ›´æ–°`train.py`ä¸­çš„æ•°æ®é›†è·¯å¾„ï¼š

```python
# è®¾ç½®è®­ç»ƒæ•°æ®é›†ç›®å½•è·¯å¾„ï¼ï¼ï¼
# è·¯å¾„ä¸­ä¸èƒ½æœ‰ä¸­æ–‡å­—ç¬¦ï¼ï¼ï¼
# Windowsç›®å½•ä½¿ç”¨ \\ ç»“å°¾ï¼ŒLinuxç›®å½•ä½¿ç”¨ / ç»“å°¾
train_dataset_path = r"C:\Users\xxx\Downloads\datasets\\"
# train_dataset_path = r"/mnt/datasets/"
```

2. æ ¹æ®éœ€è¦è°ƒæ•´è¶…å‚æ•°ï¼š

```python
# æ¨¡å‹è¶…å‚æ•°è®¾ç½®
epochs = 20             # è®­ç»ƒè½®æ¬¡
batch_size = 2          # æ¯ä¸ªæ‰¹æ¬¡çš„æ ·æœ¬æ•°
learn_rate = 0.001      # å­¦ä¹ ç‡
```

3. å¼€å§‹è®­ç»ƒï¼š

```bash
cd CTAI_model
python train.py
```

è®­ç»ƒè¿‡ç¨‹ä¼šè‡ªåŠ¨ä¿å­˜æœ€ä½³æ¨¡å‹ï¼Œå¹¶ç”Ÿæˆè®­ç»ƒè¿‡ç¨‹çš„æŸå¤±æ›²çº¿ã€‚

### æµ‹è¯•æ¨¡å‹

1. ä¿®æ”¹`test.py`ä¸­çš„æµ‹è¯•æ•°æ®è·¯å¾„ï¼š

```python
# è®¾ç½®æµ‹è¯•æ•°æ®é›†ç›®å½•è·¯å¾„
test_data_path = r"C:\Users\xxx\Downloads\datasets\\"
```

2. è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š

```bash
cd CTAI_model
python test.py
```

æµ‹è¯•ç»“æœå°†ä¿å­˜åœ¨`./test-out/`ç›®å½•ä¸­ã€‚

## ğŸ“ è®¸å¯è¯
æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯
